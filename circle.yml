machine:
  environment:
    PATH: ~/.roswell/bin:$PATH
    LISP: $(if [ "$CIRCLE_NODE_INDEX" = 0 ]; then echo "sbcl"; else echo "ccl"; fi)
    COVERALLS: $(if [ "$LISP" = "sbcl" ]; then echo "true"; fi)
    COVERAGE_EXCLUDE: t/

checkout:
  pre:
    - curl -L https://raw.githubusercontent.com/snmsts/roswell/master/scripts/install-for-ci.sh | sh
    - ros run -- --version

dependencies:
  override:
    - git clone https://github.com/fukamachi/clack ~/lisp/clack
    - git clone -b circleci https://github.com/fukamachi/cl-coveralls ~/lisp/cl-coveralls
    - git clone https://github.com/fukamachi/prove ~/lisp/prove
    - ros -l ~/lisp/prove/prove.asd install prove

test:
  override:
    - run-prove t-*.asd: {parallel: true}