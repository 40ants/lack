machine:
  environment:
    PATH: ~/.roswell/bin:$PATH

checkout:
  pre:
    - curl -L https://raw.githubusercontent.com/snmsts/roswell/release/scripts/install-for-ci.sh | sh
    - case $CIRCLE_NODE_INDEX in
        0) ros config set default.lisp sbcl-bin ;;
        1) ros install ccl-bin;
           ros config set default.lisp ccl-bin ;;
      esac
    - ros run -- --version

dependencies:
  pre:
    - git clone https://github.com/fukamachi/qlot ~/lisp/qlot
    - ros -l ~/lisp/qlot/qlot.asd install qlot
  override:
    - if [ ! -d quicklisp ]; then qlot install; fi
  cache_directories:
    - "quicklisp"

test:
  override:
    - qlot exec ./run-test.ros t-*.asd: {parallel: true}